var usernameInput,fullnameInput,emailInput,passwordInput,registerBtn,currentPath=window.location.pathname;function setCookie(e,t,a){var s,o="; expires=";a&&((s=new Date).setTime(s.getTime()+24*a*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/; SameSite=Strict"}function cookieExists(e){for(var t=document.cookie.split(";"),a=0;a<t.length;a++)if(0===t[a].trim().indexOf(e+"="))return!0;return!1}function deleteCookie(e){expires="; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie=e+"="+expires+"; path=/; SameSite=Strict"}"/login"==currentPath&&($("#icon-click").on("click",function(e){var t=$("#icon");t.hasClass("bi-eye-slash")?($("#pass").attr("type","text"),t.removeClass("bi-eye-slash"),t.addClass("bi-eye")):t.hasClass("bi-eye")&&($("#pass").attr("type","password"),t.removeClass("bi-eye"),t.addClass("bi-eye-slash"))}),cookieExists("fingerprint")&&deleteCookie("fingerprint"),$("#rememberMe").on("click",function(){$("#rememberMe").is(":checked")?cookieExists("fingerprint")||fetch("https://openfpcdn.io/fingerprintjs/v3").then(e=>{e.ok&&import("https://openfpcdn.io/fingerprintjs/v3").then(e=>e.load()).then(e=>e.get()).then(e=>{setCookie("fingerprint",e.visitorId,1)})}):cookieExists("fingerprint")&&deleteCookie("fingerprint")}),$("#user, #pass, #rememberMe").on("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),!1}),$(".user-login-form").on("submit",function(e){e.preventDefault(),$(".btn-login").attr("disabled",!0),$(".btn-login").html("Verifying credentials...");e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/login",data:e,processData:!1,contentType:!1,success:function(e){$(".btn-login").html("Logging in..."),"Authenticated"==e.message&&location.replace(e.redirect)},error:function(e,t){"error"==t&&(0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Invalid credentials!</b> Please try again.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form")),$(".btn-login").attr("disabled",!1),$(".btn-login").html("Login now!"))}})})),"/register"==currentPath&&(usernameInput=$("#username"),fullnameInput=$("#fullname"),emailInput=$("#email"),passwordInput=$("#password"),registerBtn=$(".btn-register"),$("#fullname, #username, #password, #email").on("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),!1}),$(function(){function e(){var e=$(this),t=e.val().trim(),a=!1,s=e.next(".invalid-feedback"),t=("username"===e.attr("id")?(a=/^[a-zA-Z][a-zA-Z_]*$/.test(t),s.text("It should not contain any special characters except letters and underscore.")):"fullname"===e.attr("id")?(a=/^[A-Za-z]+(\s[A-Za-z]+)*$/.test(t),s.text("It should not contain numbers or special characters.")):"email"===e.attr("id")?(a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),s.text("Please enter a valid email address.")):"password"===e.attr("id")&&(a=8<=t.length,s.text("Password should contain at least 8 characters.")),e.toggleClass("is-invalid",!a),s.toggle(!a),!(usernameInput.hasClass("is-invalid")||fullnameInput.hasClass("is-invalid")||emailInput.hasClass("is-invalid")||passwordInput.hasClass("is-invalid")));registerBtn.prop("disabled",!t)}usernameInput.on("input",e),fullnameInput.on("input",e),emailInput.on("input",e),passwordInput.on("input",e)}),$(".user-register-form").on("submit",function(e){e.preventDefault(),registerBtn.html("Verifying credentials..."),registerBtn.attr("disabled",!0);e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/register",data:e,processData:!1,contentType:!1,success:function(e){1==e.result?$("section.container").html(`
                    <section class="container">
                        <div class="d-flex align-items-center justify-content-center min-vh-100">
                            <div class="py-3 col-sm-10 col-md-10 col-lg-8 col-xl-6">
                                <div class="bg-black bg-opacity-25 rounded-3 p-5 text-center border">
                                    <img src="/assets/brand/photogram-logo.png"
                                        alt="logo" class="img-fluid mx-auto d-block mb-4" width="63" height="63">
                                    <h3 class="display-6">Welcome to Photogram!</h3>
                                    <p class="lead mb-4">Your account has been created.</p>
                                    <a class="text-decoration-none" href="/login">
                                        <button class="btn btn-prime hvr-icon-forward">Continue to login <i class="fa fa-arrow-right hvr-icon" aria-hidden="true"></i></button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </section>`):console.error("Cannot insert success message")},error:function(e,t){"error"==t&&(0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Failed to register!</b> Invalid credentials.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form")),registerBtn.attr("disabled",!1),registerBtn.html("Register now!"))}})})),"/forgot-password"==currentPath&&$(".forgot-password-form").on("submit",function(e){e.preventDefault(),$(".btn-send-link").attr("disabled",!0),$(".btn-send-link").html("Sending reset link to your email...");const a=new FormData(this);$.ajax({type:"POST",url:"/api/auth/reset-password",data:a,processData:!1,contentType:!1,success:function(e){$(".btn-send-link").html("Send link"),"Success"===e.status&&location.replace("/login")},error:function(e){var t;$(".btn-send-link").attr("disabled",!1),$(".btn-send-link").html("Send link"),0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html(`<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Mail not sent!</b> Your email, ${a.get("reset_email")}, does not exist in our database.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>`),$(t).insertBefore("form"))}})});var masonry,scrollTopBtn,regex=/^\/forgot-password\/[a-zA-Z0-9]+$/,grid=(regex.test(window.location.pathname)&&($(function(){var a=$("#newPassword"),s=$("#confirmNewPassword"),o=$(".btn-change-password"),n=$(".invalid-feedback");function e(){var e=a.val(),t=s.val(),e=e===t&&0<e.length&&0<t.length;a.toggleClass("is-invalid",!e),s.toggleClass("is-invalid",!e),o.prop("disabled",!e),n.toggle(!e)}a.on("input",e),s.on("input",e)}),$(".change-password-form").on("submit",function(e){e.preventDefault();let a=$(".btn-change-password");a.attr("disabled",!0),a.html("Changing your password...");e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/reset-password",data:e,processData:!1,contentType:!1,success:function(e){a.attr("disabled",!1),a.html("Change password"),"Success"==e.status?location.replace("/login"):0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(e=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i>Unable to change the password!<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(e).insertBefore("form"))},error:function(e){var t;a.attr("disabled",!1),a.html("Change password"),0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i>Error occured! cannot change your password!<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form"))}})})),$(".btn-search").on("click",function(){var e=$(".search-input").val();$.ajax({url:"/api/users/search",type:"GET",data:{query:e},success:function(e,t){var a;0===e.data.length?console.log("No Users Found!"):(e=e.data,a=$(".list-users"),e=`
                <a href="#" class="list-group-item d-flex align-items-center bg-body-tertiary mb-2 rounded border">
                    <img src="${e.avatar}" alt="Profile ${e.id}" class="rounded-circle me-3" width="40" height="40">
                    <div class="text-truncate">
                        <h6 class="small">@${e.username}</h6>
                        <div class="d-grid mx-auto">
                            <button type="button" class="btn btn-sm btn-outline-primary"><i class="bi bi-person-add me-1"></i>Follow
                            </button>
                        </div>
                    </div>
                </a>
                `,a.append(e))},error:function(e,t,a){console.error("Error fetching users:",a)}})}),"/profile/edit"===window.location.pathname&&($(".btn-save-data").on("click",function(e){e.preventDefault();let a=document.querySelector(".user-form-data");e=new FormData(a);let s=$(".btn-save-data");s.attr("disabled",!0),s.html('<div class="spinner-border spinner-border-sm me-1" role="status"><span class="visually-hidden">Loading...</span></div>Updating...'),$.ajax({url:"/api/users/profile/update",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){var t;"Updated"==e.message?(s.attr("disabled",!1),s.html("Update profile"),0===$(".alert.alert-primary.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-primary alert-dismissible fade show").html('<i class="bi bi-info-circle me-2"></i>Profile was successfully updated<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore(a)),document.querySelector(".profile-body").scrollIntoView()):"Not Updated"==e.message&&(s.attr("disabled",!1),s.html("Update profile"))},error:function(e){console.error("Error while updating:",e)}})}),$("#btnRemoveAvatar").on("click",function(){(d=new Dialog('<i class="bi bi-trash me-2"></i>Remove Avatar','After removing the avatar, the default user avatar generated from <a href="https://dicebear.com" class="text-decoration-none">dicebear.com</a> will be set as your default avatar.<br><br><b class="fw-semibold">Are you sure to continue?</b>')).setButtons([{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}},{name:"Yes, remove",class:"btn-danger",onClick:function(e){$.post("/api/users/profile/delete",function(e,t){1==e.message&&"success"==t?location.reload():console.error(e,t)}),$(e.data.modal).modal("hide")}}]),d.show()})),document.querySelector("#masonry-area"));function showToast(e,t,a){e=new Toast(e,t,a,{}),e.show(),t=e.id,a=$("#"+t).find(".toast-header").find("small");e.showSec(a)}function likeBtn(e){var t=$("<audio>",{id:"likePop",src:"/assets/sounds/like-pop.mp3"}),a=(0===$("#likePop").length&&$("body").append(t),e.find("a").attr("id")),a=$("#"+a).find("i"),e=e.parent().next().find(".like-count"),s=parseInt(e.text());a.hasClass("fa-regular fa-heart")?(t[0].play(),a.removeClass("fa-regular fa-heart"),a.addClass("fa-solid fa-heart text-danger"),e.text(s+=1)):a.hasClass("fa-solid fa-heart text-danger")&&0!=s?(a.removeClass("fa-solid fa-heart text-danger"),a.addClass("fa-regular fa-heart"),e.text(s-1)):console.error("Cannot dislike the button")}function likePost(e,t){void 0!==e&&void 0!==t&&(likeBtn(e),$.post("/api/posts/like",{id:t}).fail(function(){likeBtn(e),console.error("Can't like the post ID: "+t)}))}grid&&(masonry=new Masonry(grid,{percentPosition:!0}),imagesLoaded(grid).on("progress",function(){masonry.layout()})),$(".carousel-control-prev, .carousel-control-next").on("click",function(){masonry.layout()}),$("img").on("contextmenu",function(){return!1}),$("img").on("dragstart",function(e){e.preventDefault()}),0!=$("#scroll-top-btn").length&&(scrollTopBtn=$("#scroll-top-btn"),$(window).on("scroll",function(){0<$(this).scrollTop()?scrollTopBtn.removeClass("d-none").fadeIn("slow"):scrollTopBtn.fadeOut(function(){$(this).addClass("d-none")})}),scrollTopBtn.on("click",function(e){e.preventDefault(),$("html").animate({scrollTop:0},"fast")})),$("[name=view_mode]").on("click",function(){var e=$(this).val();$.get("/api/users/preferences",{view:e},function(e,t){"success"===t&&!0===e.message&&location.reload()})}),$("#postUploadButton").on("click",function(){var s,e=new Dialog('<i class="bi bi-plus-circle-dotted me-2"></i>Create Post','<div class="container"><p class="lead mb-2">Add caption</p><textarea class="form-control shadow-none post-caption mb-1" name="post_text" rows="3" placeholder="Say something..."></textarea><p id="total-caption-chars" class="text-end mb-2">0/240</p><p class="lead mb-2">Add photos</p><form class="dropzone rounded mb-3" id="dzCreatePost"><div class="dz-message py-1"><i class="bi bi-images display-6"></i><p class="small">Drop photos here or click to upload</p></div></form></div>'),t=(e.setButtons([{name:"Clear",class:"btn-outline-secondary btn-reset-form"},{name:"Create post",class:"btn-prime btn-create-post"}]),e.clone),a=t.find(".modal-footer"),o=(e.show("primary",!0),a.find(".btn-create-post")),n=a.find(".btn-reset-form");$(o).attr("disabled",!0),$(n).attr("disabled",!0),document.querySelector("#dzCreatePost")&&(Dropzone.autoDiscover=!1,(s=new Dropzone("#dzCreatePost",{url:"/api/posts/create",paramName:"file",maxFiles:2,maxFilesize:5,parallelUploads:2,uploadMultiple:!0,acceptedFiles:".png,.jpeg,.jpg,.gif",autoProcessQueue:!1})).on("addedfile",function(){$(o).prop("disabled",!1),$(n).prop("disabled",!1)}),s.on("removedfile",function(){$(o).prop("disabled",!0),$(n).prop("disabled",!0),0<s.files.length&&($(o).prop("disabled",!1),$(n).prop("disabled",!1))}),s.on("sending",function(e,t,a){a.append("post_text",$(".post-caption").val())}),s.on("error",function(e){if("error"===e.status)for(var t=s.getRejectedFiles(),a=0;a<t.length;a++)s.removeFile(t[a])}),$(t).on("hide.bs.modal",function(){0<s.files.length&&s.removeAllFiles()}),$(o).on("click",function(e){e.preventDefault(),0<s.files.length?($(this).attr("disabled",!0),$(n).attr("disabled",!0),$(this).html('<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Creating post'),s.processQueue()):$(this).attr("disabled",!0)}),$(n).on("click",function(){$(".post-caption").val("");var e=$(".post-caption").val().length;$("#total-caption-chars").text(e+"/240"),0<s.files.length&&s.removeAllFiles()}),s.on("queuecomplete",function(){var e=s.getFilesWithStatus(Dropzone.ERROR);if(0<e.length){for(var t=0;t<e.length;t++)s.removeFile(e[t]);$(o).html("Create post"),$("#error-message").length||$('<p id="error-message" class="text-danger mb-1">Cannot create post!</p>').insertBefore("#dzCreatePost")}else location.replace("/home")}),$(".post-caption").on("input",function(){var e;240<$(this).val().length&&(e=$(this).val().slice(0,240),$(this).val(e)),$("#total-caption-chars").text($(this).val().length+"/240")}))}),$(".btn-like").on("click",function(){likePost($(this),$(this).attr("data-id"))}),$(".post-card-image, .carousel").on("dblclick",function(){likePost($(this).next().find(".btn-group").find(".btn-like"),$(this).attr("data-id"))}),$(".likedby-users").on("click",function(){var e=new Dialog("Likes",'<div class="container"><ul id="liked-users-list" class="list-group list-group-flush"></ul></div>'),t=(e.show("",!0),$(this).attr("data-id"));const n=e.clone,i=n.find("#liked-users-list");n.find(".modal-body").addClass("p-2"),n.find(".modal-dialog").addClass("modal-dialog-scrollable"),n.find(".modal-footer").remove(),$.post("/api/posts/users",{likes:t},function(t){if(1==t.message&&null!=t.users)for(let e=0;e<t.users.length;e++){var a=t.users[e],s=a.username,o=a.fullname,a=a.avatar;i.append('<li class="list-group-item"><div class="d-flex align-items-center justify-content-between"><div class="me-2"><div class="d-flex align-items-center"><div class="me-2"><img id="user-avatar" class="border rounded-circle" src="" width="40" height="40" loading="lazy"></div><div class="text-break"><h7 id="fullname" class="text-body"></h7><p id="username" class="mb-0 small fw-light"></p></div></div></div><div><a id="link" href="" class="btn btn-primary btn-sm">Show profile</a></div></div></li>'),i.find("#username").text("@"+s),i.find("#username").attr("id","username"+e),i.find("#fullname").text(o),i.find("#fullname").attr("id","fullname"+e),i.find("#user-avatar").attr("src",a),i.find("#user-avatar").attr("id","user-avatar"+e),i.find("#link").attr("href","/profile/"+s),i.find("#link").attr("id","link"+e)}else $('<h5 class="text-center my-5"><i class="bi bi-exclamation-triangle me-2"></i>No liked users found</h5>').prependTo(n.find(".modal-body").empty())})});const successAudio=$("<audio>",{id:"successTone",src:"/assets/sounds/success.mp3"});$(".btn-delete").on("click",function(){0===$("#successTone").length&&$("body").append(successAudio);let a=$(this).parent().attr("data-id");(d=new Dialog('<i class="bi bi-trash me-2"></i>Delete Post',"<p>Are you sure you want to delete this post?</p><p>This action cannot be undone.</p>")).setButtons([{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}},{name:"Delete post",class:"btn-danger",onClick:function(e){$.ajax({url:"/api/posts/delete",type:"POST",data:{id:a},success:function(e,t){"success"===t?(t=document.querySelector("#post-"+a),masonry.remove(t),masonry.layout(),successAudio[0].play(),showToast("Photogram","Just Now","Your post was successfully deleted!")):showToast("Photogram","Just Now","Can't delete your post!")},error:function(e,t,a){showToast("Photogram","Just Now","Can't delete your post!")}}),$(e.data.modal).modal("hide")}}]),d.show()}),$(".btn-download").on("click",function(){var e;this.hasAttribute("href")||(e=$(this).parent().data("id"),$.ajax({url:"/api/posts/download",method:"GET",data:{id:e},xhrFields:{responseType:"arraybuffer"},success:function(e,t,a){var s=a.getResponseHeader("Content-Type"),e=new Blob([e],{type:s}),s=window.URL.createObjectURL(e);$(this).attr("href",s);e=(e=a.getResponseHeader("Content-Disposition").match(/filename="?([^"]+)"?/))?e[1]:"images.zip";$(this).attr("download",e),$(this).get(0).click(),window.URL.revokeObjectURL(s),$(this).removeAttr("href")}.bind(this),error:function(e){showToast("Photogram","Just Now","Cannot download the post!")}}))}),$(".btn-copy-link").on("click",function(){0===$("#successTone").length&&$("body").append(successAudio);var e=$(this).parents("header").next().find(".active").find("img").attr("src"),e=window.location.origin+(null!=this.getAttribute("value")?$(this).attr("value"):e);navigator.clipboard?navigator.clipboard.writeText(e)&&(successAudio[0].play(),showToast("Photogram","Just Now","Copied the post link to the clipboard!")):(console.error("Can't copy the post link!"),showToast("Photogram","Just Now","Can't copy the post link to the clipboard!"))}),$(".btn-full-preview").on("click",function(){var e=$(this).parents("header").next(),t=new Dialog('<i class="fa-solid fa-expand me-2 small"></i>Full Preview',"","xlarge"),a=t.clone,s=a.find(".modal-body");$(a).on({contextmenu:function(){return!1},dragstart:function(e){e.preventDefault()}}),a.find(".modal-body").addClass("p-0"),a.find(".modal-header").addClass("border-0 px-3 py-1"),a.find(".modal-title").addClass("fs-6 fw-normal"),a.find(".modal-footer").remove(),t.show("",!0),e.hasClass("carousel")?(e.clone().appendTo(s),carousel_sel="post-image-full-preview",s.find(".carousel").attr("id",carousel_sel),s.find(".carousel-item > img").removeClass("post-img"),s.find(".carousel-inner").addClass("rounded"),s.find(".carousel-control-prev").attr("data-bs-target","#"+carousel_sel),s.find(".carousel-control-next").attr("data-bs-target","#"+carousel_sel)):e.hasClass("post-card-image")?($("<div>").addClass("d-flex align-items-center justify-content-center").html(e.clone()).appendTo(s),s.find(".post-card-image").removeClass("post-img"),s.find(".post-card-image").addClass("img-fluid")):console.error("Cannot preview post image.")}),$(".btn-edit-post").on("click",function(){0===$("#successTone").length&&$("body").append(successAudio);const t=$(this).parent().attr("data-id");let s=$(this).parents("header").next().next(),a=s.find(".post-text").text();var e=s.find(".post-text").html().replace(/<br\s*\/?>/gi,"").replace(/<[^>]+>/g,"");let o=new Dialog('<i class="bi bi-pencil me-2"></i>Edit Your Post',`<div class="container my-3"><p class="form-label">Change post text:</p><textarea class="form-control post-text" name="post_text" rows="5" placeholder="Say something..." spellcheck="false">${e}</textarea><p class="total-chars visually-hidden text-end mt-2"></p></div>`),n=(o.setButtons([{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}},{name:"Update post",class:"btn-prime btn-update-post",onClick:function(e){let a=$(o.clone).find(".post-text").val().replace(/#(\w+)/g,'<a href="/discover/tags/$1">#$1</a>');$(o.clone).find(".btn-update-post").prop("disabled",!0),$.ajax({url:"/api/posts/update",type:"POST",data:{id:t,text:a},success:function(e,t){"success"==t?(successAudio[0].play(),s.find(".post-text").css("white-space","pre-line"),s.find(".post-text").html(a.replace(/<br\s*\/?>/gi,"<br>")),masonry.layout(),showToast("Photogram","Just Now","Post text changed successfully!")):showToast("Photogram","Just Now","Can't change the post text!")},error:function(e,t,a){showToast("Photogram","Just Now","Can't change the post text: "+e.responseText)}}),$(e.data.modal).modal("hide")}}]),o.show(),$(o.clone).find(".post-text"));$(o.clone).find(".btn-update-post").prop("disabled",!0),$(n).on("input",function(){n.val()!=a?$(o.clone).find(".btn-update-post").prop("disabled",!1):$(o.clone).find(".btn-update-post").prop("disabled",!0);var e=$(".total-chars"),t=$(this).val().length;e.removeClass("visually-hidden"),240<t&&(t=$(this).val().slice(0,240),$(this).val(t)),e.text($(this).val().length+"/240")})});
//# sourceMappingURL=app.min.js.map